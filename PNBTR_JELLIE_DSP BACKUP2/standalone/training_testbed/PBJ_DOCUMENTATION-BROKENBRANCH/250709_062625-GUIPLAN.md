# PNBTR+JELLIE Training Testbed — Current GUI Layout (Text Mock-up)

```
+-----------------------------------------------------------------------------------+
| [Title Bar: TitleComponent]                                                       |
|   PNBTR+JELLIE Training Testbed                                                   |
+-----------------------------------------------------------------------------------+
| [Transport Bar: ProfessionalTransportController]                                  |
|   [Play] [Pause] [Stop] [Record]  SESSION TIME: 00:00:00.000.000  BARS: 1.1.1     |
|   BPM: 120.0 [slider]    :: Packet Loss [%] [slider]  Jitter [ms] [slider]        |
+-----------------------------------------------------------------------------------+
| [Oscilloscope Row: OscilloscopeRow]                                               |
|   Input      |  Network    |  Log/Status        |  Output                         |
|   [osc]      |  [osc]      |  [log/status box]  |  [osc]                          |
+-----------------------------------------------------------------------------------+
| [Waveform Analysis Row: WaveformAnalysisRow]                                      |
|   Input Analysis Oscilloscope                                                     |
|   [osc]                                                                           |
|   JELLIE Track (Recorded Input)                                                   |
|   [audio thumbnail]                                                               |
+-----------------------------------------------------------------------------------+
| [Audio Tracks Row: AudioTracksRow]                                                |
|   Reconstruction Analysis Oscilloscope                                            |
|   [osc]                                                                           |
|   PNBTR Track (Reconstructed Output)                                              |
|   [audio thumbnail]                                                               |
+-----------------------------------------------------------------------------------+
| [Metrics Dashboard: MetricsDashboard]                                             |
|   [metrics: SNR, latency, packet loss, etc.]                                      |
+-----------------------------------------------------------------------------------+
```

**Descriptions:**
- **Transport Bar:** Top row, provides millisecond-accurate transport controls, session time, bars/beats, and BPM slider.
- **Title Bar:** Displays the application title.
- **Oscilloscope Row:** Four columns: Input, Network, Log/Status, Output. Each shows a real-time oscilloscope or log.
- **Waveform Analysis Row:** Two stacked oscilloscopes for input and reconstruction analysis.
- **Audio Tracks Row:** Two stacked audio thumbnails for recorded input (JELLIE) and reconstructed output (PNBTR).
- **Metrics Dashboard:** Docked row showing real-time/session metrics.
- **Controls Row:** Bottom row with all training controls (start/stop, export, sliders for packet loss, jitter, gain).

---

GitHub Copilot: Here’s how I’ll proceed to integrate your custom PNBTR_JELLIE components into the GUI:

**Step 1: Identify the custom PNBTR_JELLIE components**

The following are the actual PNBTR_JELLIE DSP components and modules that will be integrated into the GUI:

- **PNBTRTrainer** (`Source/DSP/PNBTRTrainer.h` / `PNBTRTrainer.cpp`):
  - The main GPU-native training harness, handling the full audio pipeline: Input → JELLIE Encode → Network Simulation → PNBTR Reconstruction → Output.
  - Exposes methods for setting packet loss, jitter, gain, and for starting/stopping training.
  - Provides access to GPU buffers for oscilloscope and waveform visualization.

- **TrainingMetrics** (`Source/Metrics/TrainingMetrics.h`):
  - Collects and provides real-time and session metrics for the training process.

- **MetalBridge** (`Source/GPU/MetalBridge.h` / `MetalBridge.mm`):
  - Handles low-level GPU buffer management and Metal kernel dispatch for real-time DSP.

- **PacketLossSimulator** (used by `PNBTRTrainer`):
  - Simulates network packet loss and jitter as part of the training pipeline.

- **OscilloscopeComponent** and **AudioThumbnailComponent** (`Source/GUI/OscilloscopeComponent.h`, `AudioThumbnailComponent.h`):
  - GUI components for visualizing input, encoded, network, and reconstructed buffers.
  - Will be wired to display real data from the PNBTRTrainer’s GPU buffers.

- **MetricsDashboard** (`Source/GUI/MetricsDashboard.h`):
  - GUI component for displaying real-time metrics from `TrainingMetrics`.

- **ControlsRow** (`Source/GUI/ControlsRow.h`):
  - GUI controls for training (start/stop), packet loss, jitter, gain, etc., to be connected to `PNBTRTrainer` methods.

- **Other supporting modules** (as needed):
  - Any additional custom visualizations, controls, or helpers unique to the PNBTR+JELLIE pipeline.

**Step 2: Map components to GUI locations**

Here is where each custom PNBTR_JELLIE component will be placed in the schematic row-based GUI, matching the mock-up above:

- **TitleComponent** (Title Bar):
  - Topmost row, displays the application title.

- **ProfessionalTransportController** (Transport Bar):
  - Second row, directly below the title.
  - Provides millisecond-accurate transport controls, session time, bars/beats, BPM slider, and now also Packet Loss [%] and Jitter [ms] sliders (these are not in ControlsRow).

- **OscilloscopeRow**:
  - Third row. Four horizontally arranged components:
    - Input Oscilloscope: Visualizes real-time input buffer from PNBTRTrainer (pre-JELLIE encode).
    - Network Oscilloscope: Visualizes buffer after network simulation (post-packet loss/jitter).
    - LogStatusComponent: Displays log/status messages.
    - Output Oscilloscope: Visualizes reconstructed output buffer from PNBTRTrainer (post-PNBTR decode).

- **WaveformAnalysisRow**:
  - Fourth row. Stacked vertically:
    - Top: Input Analysis Oscilloscope (visualizes input buffer with graphic filters).
    - Below: JELLIE Track (Recorded Input) — AudioThumbnailComponent for recorded input waveform.

- **AudioTracksRow**:
  - Fifth row. Stacked vertically:
    - Top: Reconstruction Analysis Oscilloscope (visualizes reconstructed buffer with graphic filters).
    - Below: PNBTR Track (Reconstructed Output) — AudioThumbnailComponent for reconstructed output waveform.

- **MetricsDashboard**:
  - Sixth row. Docked, not floating. Displays real-time and session metrics from TrainingMetrics (e.g., SNR, latency, packet loss, etc.).

- **ControlsRow**:
  - Bottom row. Contains only:
    - Start/Stop/Export buttons (wired to PNBTRTrainer).
    - Gain [dB] slider (wired to PNBTRTrainer).
    - (No Packet Loss or Jitter sliders here; those are in the Transport Bar.)

- **Supporting modules (MetalBridge, PacketLossSimulator, etc.):**
  - Not directly visualized, but used internally by PNBTRTrainer and GUI components for data flow and processing.

---

**Step 3: Plan the integration order (matching the mock-up)**

1. **Instantiate and own a `PNBTRTrainer` in the main app/component.**
   - Add a `std::unique_ptr<PNBTRTrainer>` member to your main component (e.g., `MainComponent`).
   - Instantiate `PNBTRTrainer` in the constructor and ensure it is properly destroyed in the destructor.
   - This instance will be the central DSP engine for the app, and all GUI components will interact with it.

2. **Wire up the GUI controls to `PNBTRTrainer`:**
   - In `ProfessionalTransportController`, implement and wire up the Packet Loss [%] and Jitter [ms] sliders to call `setPacketLossPercentage` and `setJitterAmount` on the `PNBTRTrainer` instance.
   - In `ControlsRow`, update the callbacks for Start/Stop/Export buttons and Gain [dB] slider to call the corresponding methods on `PNBTRTrainer`.
   - Pass a pointer or reference to the `PNBTRTrainer` instance into both `ProfessionalTransportController` and `ControlsRow` (via constructor or setter).
   - Remove any placeholder or SessionManager-based control logic.

3. **Connect oscilloscope/waveform components to pull buffer data from `PNBTRTrainer` for visualization.**
   - In `OscilloscopeRow`, `WaveformAnalysisRow`, and `AudioTracksRow`, update the oscilloscope and audio thumbnail components to fetch their data from the appropriate GPU buffer in `PNBTRTrainer` (e.g., use `getInputBuffer`, `getOutputBuffer`).
   - Ensure thread safety when accessing buffers (use locks or atomics as needed).

4. **Connect MetricsDashboard to `TrainingMetrics` from `PNBTRTrainer`.**
   - Pass a pointer or reference to the `TrainingMetrics` instance (from `PNBTRTrainer::getMetrics()`) into the `MetricsDashboard`.
   - Update the dashboard to display real-time metrics (SNR, latency, packet loss, etc.) from the live training session.

5. **Test the full pipeline and iterate on UI/UX as needed.**
   - Run the app and verify that all controls, visualizations, and metrics are live and reflect the actual DSP state.
   - Adjust layout, update rates, and error handling as needed for smooth real-time performance.
   - Gather feedback and make further UI/UX improvements based on real-world use.
